{{- $store := (input "developmentStore") -}}
{{- $require_tmstore := (or (eq $store "filetmpop") (eq $store "dummytmpop") (eq $store "postgrestmpop") (eq $store "rethinktmpop")) -}}
{
  "name": "{{input `name`}}",
  "author": "{{input `author`}}",
  "description": "{{input `description`}}",
  "license": "SEE LICENSE IN LICENSE",
  "scripts": {
{{- if eq (input `useGit`) `y` }}
{{- if $require_tmstore }}
    "init": "strat run tm:init && git init && git add .",
    "init:linux": "strat run tm:init && strat run tm:post-init:linux && git init && git add .",
{{- else }}
    "init": "git init && git add .",
{{- end}}
{{- else if $require_tmstore }}
    "init": "strat run tm:init",
{{- end}}
{{- if eq $store "tmstore" }}
    "tm:init": "docker run -it --rm -v \"$(pwd)/tendermint:/tendermint\" tendermint/tendermint:0.13.0 init",
    "tm:post-init:linux": "docker run -it --rm -v \"$(pwd)/tendermint:/tendermint\" -v \"$(pwd)/arch/linux/fix-tendermint-files-ownership.sh:/tmp/fix-tendermint-files-ownership.sh\" -e \"UID=$(id -u)\" -e \"GID=$(id -g)\" --entrypoint=/tmp/fix-tendermint-files-ownership.sh tendermint/tendermint:0.13.0 init",
    "tm:init:test": "docker run -it --rm -v \"$(pwd)/tendermint.test:/tendermint\" tendermint/tendermint:0.13.0 init",
    "tm:post-init:test:linux": "docker run -it --rm -v \"$(pwd)/tendermint.test:/tendermint\" -v \"$(pwd)/arch/linux/fix-tendermint-files-ownership.sh:/tmp/fix-tendermint-files-ownership.sh\" -e \"UID=$(id -u)\" -e \"GID=$(id -g)\" --entrypoint=/tmp/fix-tendermint-files-ownership.sh tendermint/tendermint:0.13.0 init",
{{- end}}
{{- if eq $store "fabricstore" }}
    "compose": "docker-compose -p {{input `name`}}-dev -f docker-compose.yml -f docker-compose.dev.yml -f fabric/docker-compose.yml",
    "compose:test": "docker-compose -p {{input `name`}}-test -f docker-compose.yml -f docker-compose.test.yml -f fabric/docker-compose.yml",
{{- else }}
    "compose": "docker-compose -p {{input `name`}}-dev -f docker-compose.yml -f docker-compose.dev.yml",
    "compose:test": "docker-compose -p {{input `name`}}-test -f docker-compose.yml -f docker-compose.test.yml",
{{- end }}
    "build": "strat run compose build",
    "build:test": "strat run compose:test build",
    "up": "strat run build && strat run compose up",
{{- if eq $store "fabricstore" }}
    "down": "strat run compose down && strat run clean",
{{- else }}
    "down": "strat run compose down",
{{- end}}
{{- if $require_tmstore }}
    "down:test": "strat run compose:test down; rm -rf tendermint.test",
    "down:test:linux": "strat run compose:test down; strat run tm:post-init:test:linux; rm -rf tendermint.test",
    "test": "strat run build:test && strat run tm:init:test && strat run compose:test run agent npm test",
{{- else }}
    "down:test": "strat run compose:test down",
    "test": "strat run build:test && strat run compose:test run agent npm test",
{{- end}}
{{- if eq $store "fabricstore" }}
    "clean": "strat run clean:fabric && strat run clean:couchdb",
    "clean:couchdb": "rm -rf fabric/data",
    "clean:fabric": "docker container rm $(docker container ls -a | grep dev-peer0.org1.example.com-pop-{{.chaincodeversion}} | awk '{print $1}') && docker rmi $(docker images | grep dev-peer0.org1.example.com-pop-{{.chaincodeversion}} | awk '{print $3}')",
{{- end}}
    "pull": "strat run compose pull",
    "push": "strat run compose push"
  }
}
