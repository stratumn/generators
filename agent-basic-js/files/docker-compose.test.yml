{{- with $store := (input "developmentStore") -}}
version: '2'
services:
  agent:
    build:
      dockerfile: Dockerfile.test
    env_file:
    - ./config/test.env
    - ./config/test.secret.env
    tty: true
  store:
    env_file:
    - ./config/test.env
    - ./config/test.secret.env
    tty: true
{{- if eq $store "stratumn/postgresstore" }}
  postgres:
    env_file:
    - ./config/test.env
    - ./config/test.secret.env
    tty: true
{{- end}}
{{- if eq $store "stratumn/rethinkstore" }}
  rethinkdb:
    env_file:
    - ./config/test.env
    - ./config/test.secret.env
    tty: true
{{- end}}
  fossilizer:
    env_file:
    - ./config/test.env
    - ./config/test.secret.env
    tty: true
networks:
  default:
    driver: bridge
    driver_opts:
        name: {{input "name"}}_test
{{- end}}
